function initGL(e){try{gl=e.getContext("experimental-webgl"),gl.viewportWidth=e.width,gl.viewportHeight=e.height}catch(e){}gl||alert("Could not initialise WebGL, sorry :-(")}function getShader(e,r,a){var t;if("fs"===a)t=e.createShader(e.FRAGMENT_SHADER);else{if("vs"!==a)return alert("UNDEFINED!"),null;t=e.createShader(e.VERTEX_SHADER)}return e.shaderSource(t,r),e.compileShader(t),e.getShaderParameter(t,e.COMPILE_STATUS)?t:(alert("SHADER ERROR!"),alert(e.getShaderInfoLog(t)),null)}function initShader(e){var r;r=4!==e?getShader(gl,vertexShaderStr,"vs"):getShader(gl,vertexShaderFlatStr,"vs");var a=getShader(gl,fragmentShaderStr[e],"fs");shaderProgram[e]=gl.createProgram(),gl.attachShader(shaderProgram[e],r),gl.attachShader(shaderProgram[e],a),gl.linkProgram(shaderProgram[e]),gl.getProgramParameter(shaderProgram[e],gl.LINK_STATUS)||alert("Could not initialise shader: "+e),shaderProgram[e].vertexPositionAttribute=gl.getAttribLocation(shaderProgram[e],"vertex_position"),gl.enableVertexAttribArray(shaderProgram[e].vertexPositionAttribute),shaderProgram[e].vertexNormalAttribute=gl.getAttribLocation(shaderProgram[e],"vertex_normal"),gl.enableVertexAttribArray(shaderProgram[e].vertexNormalAttribute),shaderProgram[e].modelViewProjectionMatrixUniform=gl.getUniformLocation(shaderProgram[e],"modelViewProjectionMatrix"),shaderProgram[e].modelViewMatrixUniform=gl.getUniformLocation(shaderProgram[e],"modelViewMatrix"),shaderProgram[e].normalMatrixUniform=gl.getUniformLocation(shaderProgram[e],"normalMatrix"),shaderProgram[e].renderFlatUniform=gl.getUniformLocation(shaderProgram[e],"renderFlat"),shaderProgram[e].diffuseColorUniform=gl.getUniformLocation(shaderProgram[e],"diffuseColor"),shaderProgram[e].globalTimeUniform=gl.getUniformLocation(shaderProgram[e],"globalTime")}function initShaders(){for(var e=0;e<fragmentShaderStr.length;e++)initShader(e);gl.useProgram(shaderProgram[0]),gl.uniform3f(shaderProgram[0].diffuseColorUniform,1,0,0)}function resize(e){var r=e.canvas,a=r.clientWidth,t=r.clientHeight;r.width==a&&r.height==t||(r.width=a,r.height=t,e.viewport(0,0,r.width,r.height),mat4.perspective(45,r.width/r.height,.1,100,projectionMatrix))}function drawScene(){resize(gl),gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT),mat4.identity(modelViewMatrix),mat4.translate(modelViewMatrix,[0,0,-2]),mv_PushMatrix(),rotation=document.getElementById("rotation").checked,mat4.multiply(modelViewMatrix,rotationMatrix),mat4.multiply(projectionMatrix,modelViewMatrix,modelViewProjectionMatrix),mat4.toInverseMat3(modelViewMatrix,normalMatrix),mat3.transpose(normalMatrix),gl.uniformMatrix4fv(shaderProgram[shaderNum].modelViewProjectionMatrixUniform,!1,modelViewProjectionMatrix),gl.uniformMatrix4fv(shaderProgram[shaderNum].modelViewMatrixUniform,!1,modelViewMatrix),gl.uniformMatrix3fv(shaderProgram[shaderNum].normalMatrixUniform,!1,normalMatrix),gl.uniform1f(shaderProgram[shaderNum].globalTimeUniform,(timeNow-timeStart)/1e3),gl.bindBuffer(gl.ARRAY_BUFFER,meshVertexPositionBuffer[meshNum]),gl.vertexAttribPointer(shaderProgram[shaderNum].vertexPositionAttribute,meshVertexPositionBuffer[meshNum].itemSize,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ARRAY_BUFFER,meshVertexNormalBuffer[meshNum]),gl.vertexAttribPointer(shaderProgram[shaderNum].vertexNormalAttribute,meshVertexNormalBuffer[meshNum].itemSize,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,meshVertexIndexBuffer[meshNum]),gl.drawElements(gl.TRIANGLES,meshVertexIndexBuffer[meshNum].numItems,gl.UNSIGNED_SHORT,0),mv_PopMatrix()}function animate(){if(timeNow=performance.now(),0!=lastTime&&(elapsedTime=(elapsedTime+(timeNow-lastTime))/2,rotationAngleMesh=50*elapsedTime/1e3),lastTime=timeNow,rotation){var e=mat4.create();mat4.identity(e),mat4.rotate(e,degToRad*rotationAngleMesh,[0,1,0]),mat4.multiply(e,rotationMatrix,rotationMatrix)}}function tick(){requestAnimFrame(tick),drawScene(),animate()}function meshChanged(){var e=document.getElementById("mesh_type"),r=e.options[e.selectedIndex];"BUNNY"===r.value?meshNum=0:"TEAPOT"===r.value?meshNum=1:"BOULDER"===r.value?meshNum=2:"HORSE"===r.value?meshNum=3:"COW"===r.value?meshNum=4:"POTATOHEAD"===r.value&&(meshNum=5)}function colorChanged(){var e=document.getElementById("color_type"),r=e.options[e.selectedIndex];"RED"===r.value?gl.uniform3f(shaderProgram[shaderNum].diffuseColorUniform,1,0,0):"GREEN"===r.value?gl.uniform3f(shaderProgram[shaderNum].diffuseColorUniform,0,1,0):"BLUE"===r.value?gl.uniform3f(shaderProgram[shaderNum].diffuseColorUniform,0,0,1):"CYAN"===r.value?gl.uniform3f(shaderProgram[shaderNum].diffuseColorUniform,0,1,1):"MAGENTA"===r.value?gl.uniform3f(shaderProgram[shaderNum].diffuseColorUniform,1,0,1):"YELLOW"===r.value?gl.uniform3f(shaderProgram[shaderNum].diffuseColorUniform,1,1,0):"GRAY"===r.value?gl.uniform3f(shaderProgram[shaderNum].diffuseColorUniform,.6,.6,.6):"DARKGRAY"===r.value?gl.uniform3f(shaderProgram[shaderNum].diffuseColorUniform,.4,.4,.4):"ORANGE"===r.value?gl.uniform3f(shaderProgram[shaderNum].diffuseColorUniform,1,.5,0):"INDIGO"===r.value?gl.uniform3f(shaderProgram[shaderNum].diffuseColorUniform,.4,0,1):"VIOLET"===r.value?gl.uniform3f(shaderProgram[shaderNum].diffuseColorUniform,.6,0,.9):"BLACK"===r.value?gl.uniform3f(shaderProgram[shaderNum].diffuseColorUniform,.1,.1,.1):"LIGHTBLUE"===r.value?gl.uniform3f(shaderProgram[shaderNum].diffuseColorUniform,0,.5,1):"MINTGREEN"===r.value?gl.uniform3f(shaderProgram[shaderNum].diffuseColorUniform,0,1,.5):"GREENYELLOW"===r.value&&gl.uniform3f(shaderProgram[shaderNum].diffuseColorUniform,.5,1,0)}function shaderChanged(){var e=document.getElementById("shader_type"),r=e.options[e.selectedIndex];"BlINNPHONG"===r.value?(shaderNum=0,document.getElementById("color_type").disabled=!1):"NORMAL"===r.value?(shaderNum=1,document.getElementById("color_type").disabled=!0):"POSITION"===r.value?(shaderNum=2,document.getElementById("color_type").disabled=!0):"NOISE"===r.value?(shaderNum=3,document.getElementById("color_type").disabled=!0):"FLAT"===r.value?(shaderNum=4,document.getElementById("color_type").disabled=!1):"TOON"===r.value?(shaderNum=5,document.getElementById("color_type").disabled=!1):"CLOUD"===r.value?(shaderNum=6,document.getElementById("color_type").disabled=!0):"STRIPES"===r.value?(shaderNum=7,document.getElementById("color_type").disabled=!1):"PLASMA"===r.value?(shaderNum=8,document.getElementById("color_type").disabled=!0):"SUN"===r.value?(shaderNum=9,document.getElementById("color_type").disabled=!0):"GRANITE"===r.value?(shaderNum=10,document.getElementById("color_type").disabled=!0):"GOOCH"===r.value?(shaderNum=11,document.getElementById("color_type").disabled=!0):"FIRE"===r.value?(shaderNum=12,document.getElementById("color_type").disabled=!0):"CHECKERBOARD"===r.value?(shaderNum=13,document.getElementById("color_type").disabled=!0):"MARBLE"===r.value?(shaderNum=14,document.getElementById("color_type").disabled=!0):"BRICK"===r.value?(shaderNum=15,document.getElementById("color_type").disabled=!0):"DITHER"===r.value&&(shaderNum=16,document.getElementById("color_type").disabled=!0),gl.useProgram(shaderProgram[shaderNum]),colorChanged()}function doKey(e){var r=!0,a=0,t=0;switch(e.keyCode){case 37:a=-2;break;case 39:a=2;break;case 38:t=-2;break;case 40:t=2;break;case 13:a=t=0;break;case 36:a=t=0;break;default:r=!1}if(r){e.preventDefault();var o=mat4.create();mat4.identity(o),mat4.rotate(o,degToRad*a,[0,1,0]),mat4.rotate(o,degToRad*t,[1,0,0]),mat4.multiply(o,rotationMatrix,rotationMatrix),drawScene()}}function handleMouseDown(e){mouseDown=!0,lastMouseX=e.clientX,lastMouseY=e.clientY}function handleMouseUp(e){mouseDown=!1}function handleMouseMove(e){if(mouseDown){var r=e.clientX,a=e.clientY,t=mat4.create();mat4.identity(t);var o=r-lastMouseX;mat4.rotate(t,degToRad*(o/5),[0,1,0]);var m=a-lastMouseY;mat4.rotate(t,degToRad*(m/5),[1,0,0]),mat4.multiply(t,rotationMatrix,rotationMatrix),lastMouseX=r,lastMouseY=a}}function webGLStart(){var e=document.getElementById("webgl_canvas");e.width=CANVAS_WIDTH,e.height=CANVAS_HEIGHT,initGL(e),initShaders(),initBuffers(),gl.clearColor(0,0,0,1),gl.enable(gl.DEPTH_TEST),e.onmousedown=handleMouseDown,document.onmouseup=handleMouseUp,document.onmousemove=handleMouseMove,document.addEventListener("keydown",doKey,!1),tick()}const degToRad=Math.PI/180,CANVAS_WIDTH=800,CANVAS_HEIGHT=800;var shaderProgram=new Array(16),shaderNum=0,modelViewMatrix=mat4.create(),projectionMatrix=mat4.create(),modelViewProjectionMatrix=mat4.create(),normalMatrix=mat3.create(),rotationMatrix=mat4.create();mat4.identity(rotationMatrix);var showAsWire=!1,lastTime=0,rotationAngleMesh=0,rotation=!0,elapsedTime=0,timeNow=0,timeStart=performance.now(),mouseDown=!1,lastMouseX=null,lastMouseY=null,meshNum=0,gl;
